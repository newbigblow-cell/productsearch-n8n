<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Scanner</title>
    <style>
        /* Your existing CSS */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%); min-height: 100vh; }
        .hidden { display: none !important; }
        .main-content { max-width: 600px; margin: 0 auto; padding: 2rem 1rem; }
        .card { background: white; border-radius: 1rem; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        .input-field { width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem; margin-bottom: 1rem; }
        .btn { width: 100%; padding: 0.875rem; background: #4f46e5; color: white; border: none; border-radius: 0.5rem; font-size: 1rem; cursor: pointer; }
        .error-msg { background: #fef2f2; color: #dc2626; padding: 0.75rem; border-radius: 0.5rem; margin-top: 1rem; }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="card">
            <h2>Product Lookup</h2>
            <input type="text" id="itemNoInput" class="input-field" placeholder="Enter Item Number" value="BO-9017">
            <button class="btn" onclick="handleSearch()">Search Product</button>
            <div id="result"></div>
        </div>
    </div>

    <script>
        async function handleSearch() {
            const itemNo = document.getElementById('itemNoInput').value.trim();
            const resultEl = document.getElementById('result');
            
            if (!itemNo) {
                resultEl.innerHTML = '<div class="error-msg">Please enter Item Number</div>';
                return;
            }

            resultEl.innerHTML = 'Searching...';

            try {
                // Method 1: Try direct request first
                const response = await fetch('https://n8n.hdd.hk/webhook/product-lookup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ itemNo: itemNo })
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                displayResult(data);
                
            } catch (error) {
                console.log('Direct request failed, trying proxy...');
                
                // Method 2: Use CORS proxy as fallback
                try {
                    const proxyResponse = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent('https://n8n.hdd.hk/webhook/product-lookup')}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ itemNo: itemNo })
                    });
                    
                    const proxyData = await proxyResponse.json();
                    displayResult(proxyData);
                    
                } catch (proxyError) {
                    // Method 3: Last resort - use no-cors and suggest manual check
                    resultEl.innerHTML = `
                        <div class="error-msg">
                            CORS Issue Detected<br><br>
                            Please:<br>
                            1. Check n8n OPTIONS method configuration<br>
                            2. Or run this curl command:<br>
                            <code style="background:#f3f4f6;padding:0.5rem;display:block;margin-top:0.5rem;">
                            curl -X POST https://n8n.hdd.hk/webhook/product-lookup -H "Content-Type: application/json" -d '{"itemNo":"${itemNo}"}'
                            </code>
                        </div>
                    `;
                }
            }
        }

        function displayResult(data) {
            const resultEl = document.getElementById('result');
            
            if (data.success && data.products && data.products.length > 0) {
                let html = '<div style="background:#f0f9ff;padding:1rem;border-radius:0.5rem;margin-top:1rem;">';
                html += `<h3>Found ${data.products.length} Product(s)</h3>`;
                
                data.products.forEach(product => {
                    html += `<div style="border:1px solid #bae6fd;padding:1rem;margin:0.5rem 0;border-radius:0.25rem;">`;
                    html += `<strong>ItemNo:</strong> ${product.ItemNo}<br>`;
                    html += `<strong>Style:</strong> ${product.Style || 'N/A'}<br>`;
                    html += `<strong>Dimensions:</strong> ${product.W || ''} x ${product.D || ''} x ${product.H || ''}`;
                    html += `</div>`;
                });
                
                html += '</div>';
                resultEl.innerHTML = html;
            } else {
                resultEl.innerHTML = `<div class="error-msg">${data.error || 'No products found'}</div>`;
            }
        }

        // Test immediately on load
        setTimeout(() => {
            handleSearch();
        }, 1000);
    </script>
</body>
</html>
